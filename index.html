<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>‡§®‡•ç‡§Ø‡§æ‡§Ø‡§ó‡•ç‡§∞‡§®‡•ç‡§•‡§æ‡§É - Final Textual Tree</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: 'Noto Sans Devanagari', sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 10px;
    }

    svg {
      background: white;
      border: 1px solid #ccc;
      border-radius: 6px;
      display: block;
      margin: auto;
    }

    .link {
      fill: none;
      stroke: #aaa;
      stroke-width: 1.5px;
    }

    .node circle.main {
      fill: #555;
    }

    .node circle.expand-button {
      fill: red;
      cursor: pointer;
    }

    .node text {
      font-size: 15px;
    }

    .expandable {
      fill: maroon;
      font-weight: bold;
    }

    .clickable {
      fill: blue;
      text-decoration: underline;
      cursor: pointer;
    }
  </style>
</head>
<body>

<svg width="800" height="600"></svg>

<script>
// Define tree data
const data = {
  name: "‡§®‡•ç‡§Ø‡§æ‡§Ø‡§ó‡•ç‡§∞‡§®‡•ç‡§•‡§æ‡§É",
  children: [
    {
      name: "‡§®‡•ç‡§Ø‡§æ‡§Ø‡§∏‡•Ç‡§§‡•ç‡§∞‡§≠‡§æ‡§∑‡•ç‡§Ø‡§Æ‡•ç",
      children: [
        { name: "üìñ ‡§®‡•ç‡§Ø‡§æ‡§Ø‡§∏‡•Ç‡§§‡•ç‡§∞‡§æ‡§£‡§ø", link: "#" },
        { name: "üìñ ‡§µ‡§æ‡§∞‡•ç‡§§‡§ø‡§ï‡§Æ‡•ç", link: "#" },
        { name: "üìñ ‡§ü‡•Ä‡§ï‡§æ", link: "#" }
      ]
    },
    {
      name: "‡§§‡§§‡•ç‡§§‡•ç‡§µ‡§ö‡§ø‡§®‡•ç‡§§‡§æ‡§Æ‡§£‡§ø‡§É",
      children: [
        { name: "üìñ ‡§∂‡§¨‡•ç‡§¶‡§ñ‡§£‡•ç‡§°‡§É", link: "#" },
        { name: "üìñ ‡§∏‡§™‡•ç‡§§‡§¶‡§∂‡§ñ‡§£‡•ç‡§°‡§É", link: "#" },
        { name: "üìñ ‡§Ü‡§∞‡•ç‡§∑‡§ñ‡§£‡•ç‡§°‡§É", link: "#" }
      ]
    },
    {
      name: "‡§§‡§∞‡•ç‡§ï‡§∏‡§ô‡•ç‡§ó‡•ç‡§∞‡§π‡§É",
      children: [
        { name: "üìñ ‡§™‡•ç‡§∞‡§∏‡•ç‡§§‡§æ‡§µ‡§®‡§æ", link: "#" },
        { name: "üìñ ‡§∏‡§™‡•ç‡§§‡§™‡§¶‡§æ‡§∞‡•ç‡§•", link: "#" },
        { name: "üìñ ‡§¶‡•É‡§∑‡•ç‡§ü‡§æ‡§®‡•ç‡§§‡§ñ‡§£‡•ç‡§°‡§É", link: "#" },
        { name: "üìñ ‡§®‡•ç‡§Ø‡§æ‡§Ø‡§¶‡§∞‡•ç‡§∂‡§®‡§Æ‡•ç", link: "#" } // New Subnode Added
      ]
    }
  ]
};

const width = 800;
const height = 600;

const svg = d3.select("svg")
  .attr("viewBox", [0, 0, width, height]);

const treeLayout = d3.tree()
  .size([height - 80, width - 200]);

let root = d3.hierarchy(data, d => d.children);

// Collapse all except root
root.children.forEach(collapse);

treeLayout(root);

const gLink = svg.append("g")
  .attr("fill", "none")
  .attr("stroke", "#555")
  .attr("stroke-opacity", 0.4)
  .attr("stroke-width", 1.5);

const gNode = svg.append("g");

update(root);

function update(source) {
  const nodes = root.descendants();
  const links = root.links();

  treeLayout(root);

  // Update links
  const link = gLink.selectAll("path")
    .data(links, d => d.target.data.name);

  link.join("path")
    .transition()
    .attr("d", d3.linkVertical()
      .x(d => d.y + 100)
      .y(d => d.x + 40)
    );

  // Update nodes
  const node = gNode.selectAll("g")
    .data(nodes, d => d.data.name);

  const nodeEnter = node.join("g")
    .attr("transform", d => `translate(${d.y + 100},${d.x + 40})`);

  // Red clickable button only for expandable nodes
  nodeEnter.filter(d => d._children || d.children)
    .append("circle")
    .attr("class", "expand-button")
    .attr("r", 6)
    .attr("cx", -15)
    .attr("cy", 0)
    .on("click", (event, d) => {
      d.children = d.children ? null : d._children;
      d._children = d.children ? null : d._children;
      update(d);
      event.stopPropagation(); // Prevent event bubbling
    });

  // Main visual node
  nodeEnter.append("circle")
    .attr("class", "main")
    .attr("r", 4)
    .attr("fill", d => (d._children || d.children) ? "#555" : "#999");

  nodeEnter.append("text")
    .attr("dy", "0.31em")
    .attr("x", 10)
    .attr("text-anchor", "start")
    .attr("class", d => {
      if (d._children || d.children) return "expandable";
      if (d.data.link) return "clickable";
      return "";
    })
    .text(d => d.data.name)
    .on("click", (event, d) => {
      if (d.data.link) {
        window.open(d.data.link, "_blank");
        event.stopPropagation();
      }
    });
}

function collapse(d) {
  if (d.children) {
    d._children = d.children;
    d.children = null;
    d._children.forEach(collapse);
  }
}
</script>

</body>
</html>
